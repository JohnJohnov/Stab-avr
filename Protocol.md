[b]Протокол передачи информационных и управляющих данных между стабилизатором мощности/напряжения/тока и управляющим устройством[/b]

Стабилизатор без дополнительного запроса с интервалом порядка секунды передает управляющему устройству информационную посылку символами в ASCII коде.
В интервале между информационными посылками стабилизатор принимает от управляющего устройства управляющую посылку символами в ASCII коде.

[b][i]====Параметры порта:[/i][/b]

[b]9600N1[/b], т.е.
[list=*]
[*]скорость 9600,[/*]
[*]четность не проверяется,[/*]
[*]один стоп-бит.[/*]
[/list]

[u][b]Информация от стабилизатора[/b][/u]

[b][i]====Формат посылки:[/i][/b]

[b]T[color=red]AA[/color][color=brown]BB[/color][color=green]CCCC[/color][color=blue]DDDD[/color]<CR>[/b], где
[list=*]
[*][b]T[/b] - заголовок [color=grey](буква «T» &#54)[/color][/*]
[*][color=red]AA[/color] - служебный байт «состав»[/*]
[*][color=brown]BB[/color] - служебный байт «режим + ошибки»[/*]
[*][color=green]CCCC[/color] - основной параметр [color=grey](два байта, передаются в виде шестнадцатиричного числа 0х0000..0хFFFF, диапазон значений 0...65535)[/color][/*]
[*][color=blue]DDDD[/color] - дополнительный параметр [color=grey](два байта, передаются в виде шестнадцатиричного числа 0х0000..0хFFFF, диапазон значений 0...65535)[/color][/*]
[*][b]<CR>[/b] - признак конца посылки [color=grey](символ "возврат каретки" &#OD)[/color][/*]
[/list]

[i]Пример 1. Возможная посылка от [url=https://alcodistillers.ru/forum/viewtopic.php?id=1524]Стабилизированного регулятора на базе Arduino...[/url]:[/i]

[b]T[color=red]05[/color][color=brown]00[/color][color=green]03EA[/color][color=blue]03E8[/color]<CR>[/b], где
[list=*]
[*][color=red]05[/color] - «состав» (основной - напряжение в нагрузке, доп. - уставка напряжения)[/*]
[*][color=brown]00[/color] - «режим + ошибки» (режим рабочий, ошибок нет)[/*]
[*][color=green]03EA[/color] - основной параметр (напряжение в нагрузке - 100,2В)[/*]
[*][color=blue]03E8[/color] - доп.параметр (уставка - 100,0В)[/*]
[/list]

[i]Пример 2. Возможная посылка от [url=https://alcodistillers.ru/forum/viewtopic.php?id=1549]Простого стабилизатора мощности ТЭНа...[/url]:[/i]

[b]T[color=red]17[/color][color=brown]08[/color][color=green]04E2[/color][color=blue]08D5[/color]<CR>[/b], где
[list=*]
[*][color=red]17[/color] - «состав» (основной - мощность в нагрузке, доп. - напряжение сети)[/*]
[*][color=brown]08[/color] - «режим + ошибки» (режим рабочий, напряжения сети недостаточно для достижения уставки)[/*]
[*][color=green]04E2[/color] - основной параметр (мощность в нагрузке - 1250Вт)[/*]
[*][color=blue]08D5[/color] - доп.параметр (напряжение сети - 226,1В)[/*]
[/list]

[b][i]====Служебный байт «Состав данных»[/i][/b]

Байт «состав данных» формируется побитово, в зависимости от типов передаваемых параметров, передаётся в виде шестнадцатиричного числа. 

Исходим из того, что стабилизатор удерживает уставку на выходе с достаточной точностью, потому основной параметр может быть измеренный, уставка, рассчитанный и пр. 
Единственное требование - [u]основной параметр должен максимально точно отражать состояние нагрузки.[/u]
Основной параметр для конкретного стабилизатора не меняется и передается в каждой посылке. 
Дополнительный параметр - может изменяться от посылки к посылке с соответствующим изменением байта «состав данных».

[b]b[/b]000000[b][color=red]хх[/color][/b] - младшие два бита описывают основной параметр
[list=*]
[*]00 - запрещённое значение[/*]
[*]01 - напряжение в нагрузке[/*]
[*]10 - ток в нагрузке[/*]
[*]11 - мощность в нагрузке[/*]
[/list]

[b]b[color=red]xxхххх[/color][/b]00 - старшие шесть бит описывают дополнительный параметр
[list=*]
[*]000000 - нет параметра[/*]
[*]000001 - напряжение в нагрузке (если основной - напряжение, то напряжение уставки)[/*]
[*]000010 - ток в нагрузке (если основной - ток, то ток уставки)[/*]
[*]000011 - мощность в нагрузке (если основной - мощность, то мощность уставки)[/*]
[*]000100 - сопротивление нагрузки[/*]
[*]000101 - напряжение сети[/*]
[*]прочие - ...[/*]
[/list]

[i]Пример 3. Байт "состав данных" для [url=https://alcodistillers.ru/forum/viewtopic.php?id=1524]Стабилизированного регулятора на базе Arduino...[/url]:[/i]

[b]0х05, т.е (b[color=blue]000001[/color][color=red]01[/color])[/b], где
[list=*]
[*]b[color=gray]000001[/color][color=red]01[/color] - основной параметр - напряжение в нагрузке[/*]
[*]b[color=red]000001[/color][color=gray]01[/color] - дополнительный параметр - напряжение уставки[/*]
[/list]

[i]Пример 4. Байт "состав данных" для [url=https://alcodistillers.ru/forum/viewtopic.php?id=1549]Простого стабилизатора мощности ТЭНа...[/url]:[/i]

[b]0х17, т.е (b[color=blue]000101[/color][color=red]11[/color])[/b], где
[list=*]
[*]b[color=gray]000101[/color][color=red]11[/color] - основной параметр - мощность в нагрузке[/*]
[*]b[color=red]000101[/color][color=gray]11[/color] - дополнительный параметр - напряжение сети[/*]
[/list]

[b][i]====Служебный байт «Режим + ошибки»[/i][/b]

Байт "режим + ошибки" формируется побитово, в зависимости от состояния стабилизатора, передаётся в виде шестнадцатиричного числа. 

[b]b[/b]000000[b][color=red]хх[/color][/b] - младшие два бита описывают режим
[list=*]
[*]00 - рабочий режим (стабилизатор старается поддерживать заданный выходной параметр)[/*]
[*]01 - разгон[/*]
[*]10 - нагрузка отключена[/*]
[*]11 - аварийное отключение нагрузки (удаленное включение невозможно)[/*]
[/list]

[b]b[color=red]xxхххх[/color][/b]00 - старшие шесть бит описывают ошибки
[list=*]
[*]000000 - ошибок нет[/*]
[*]000001 - отсутствие сетевого напряжения, нагрузка отключена[/*]
[*]000010 - напряжения сети недостаточно для достижения уставки[/*]
[*]прочие - ...[/*]
[/list]

[i]Пример 5. Байт «режим + ошибки» в рабочем режиме и в отсутствие ошибок:[/i]

[b]0х00, т.е (b[color=blue]000000[/color][color=red]00[/color])[/b], где
[list=*]
[*]b[color=gray]000000[/color][color=red]00[/color] - режим рабочий[/*]
[*]b[color=red]000000[/color][color=gray]00[/color] - ошибок нет[/*]
[/list]

[i]Пример 6. Байт «режим + ошибки» в рабочем режиме при недостаточном напряжении сети:[/i]

[b]0х08, т.е (b[color=blue]000010[/color][color=red]00[/color])[/b], где
[list=*]
[*]b[color=gray]000010[/color][color=red]00[/color] - режим рабочий[/*]
[*]b[color=red]000010[/color][color=gray]00[/color] - напряжения сети недостаточно для достижения уставки[/*]
[/list]

[i]Пример 7. Байт «режим + ошибки» в отсутствие сети:[/i]

[b]0х06, т.е (b[color=blue]000001[/color][color=red]10[/color])[/b], где
[list=*]
[*]b[color=gray]000001[/color][color=red]10[/color] - нагрузка отключена[/*]
[*]b[color=red]000001[/color][color=gray]10[/color] - отсутствие сетевого напряжения, нагрузка отключена[/*]
[/list]

[b][i]====Формат передачи параметров[/i][/b]

Значения параметров передаются в виде двухбайтного шестнадцатиричного числа в ASCII-коде

[list=*]
[*]Мощность - в Ваттах. Например: 1250Вт -> 0x04E2 -> [b]04E2[/b][/*]
[*]Напряжение - в Вольтах, умноженных на 10. Например: 226,1В -> 2261 -> 0x08D5 -> [b]08D5[/b][/*]
[*]Ток - в Амперах, умноженных на 100. Например: 15,22А -> 1522 -> 0x05F2 -> [b]05F2[/b][/*]
[*]Сопротивление - в Омах, умноженных на 100. Например: 15,11Ом -> 1511 -> 0x05E7 -> [b]05E7[/b][/*]
[/list]


==========
[u][b]Управление стабилизатором[/b][/u]

[b][i]====Формат посылки для установки режима:[/i][/b]

[b][color=red]M[/color][color=green]A[/color]<CR>[/b], где
[list=*]
[*][color=red]M[/color] - Заголовок [color=grey](буква «M» &#4D или «m» &#6D)[/color][/*]
[*][color=green]A[/color] - код режима [color=grey](идентичен коду режима в байте «режим + ошибки»)[/color]
[list=*]
[*]0 - перейти в рабочий режим (стабилизатор старается поддерживать заданный выходной параметр)[/*]
[*]1 - перейти в режим «разгон»[/*]
[*]2 - отключить нагрузку[/*]
[/list][/*]
[*][b]<CR>[/b] - признак конца посылки [color=grey](символ "возврат каретки" &#OD)[/color][/*]
[/list]

Т.е. 
[b][color=red]M[/color][color=green]0[/color]<CR>[/b] - перейти в рабочий режим.
[b][color=red]M[/color][color=green]1[/color]<CR>[/b] - разгон.
[b][color=red]M[/color][color=green]2[/color]<CR>[/b] - стоп.

[b][i]====Формат посылки для передачи уставки:[/i][/b]

Тип параметра уставки соответствует основному параметру, передаваемому стабилизатором в информационной посылке.
Проверка параметра на выход за пределы диапазона проводится стабилизатором.

[b][color=red]A[/color][color=green]BBBB[/color]<CR>[/b], где
[list=*]
[*][color=red]A[/color] - Заголовок (буква в зависимости от типа основного параметра: «P» &#50 или «p» &#70 - мощность, «U» &#55 или «u» &#75 - напряжение, «I» &#49 или «i» &#69 - ток)[/*]
[*][color=green]BBBB[/color] - уставка [color=grey](два байта, передаются в виде шестнадцатиричного числа в формате передачи параметров)[/color][/*]
[*][b]<CR>[/b] - признак конца посылки [color=grey](символ "возврат каретки" &#OD)[/color][/*]
[/list]

Т.е.
[b][color=red]P[/color][color=green]04E2[/color]<CR>[/b] - установить мощность 1250Вт
[b][color=red]U[/color][color=green]03E8[/color]<CR>[/b] - установить напряжение 100,0В
[b][color=red]I[/color][color=green]05F2[/color]<CR>[/b] - установить ток 15,22А
